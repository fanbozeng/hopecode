# æ•°æ®é›†åˆ†æä¸é…ç½®å»ºè®®æŠ¥å‘Š

## æ‰§è¡Œæ—¶é—´
2025-01-12

---

## ğŸ“Š æ•°æ®é›†æ€»è§ˆ

### 1. **GSM8K** (Grade School Math 8K)
- **è§„æ¨¡**: è®­ç»ƒé›† 7,474 é¢˜ / æµ‹è¯•é›† 1,320 é¢˜
- **éš¾åº¦**: å°å­¦åº”ç”¨é¢˜ï¼ˆ2-8æ­¥æ¨ç†ï¼‰
- **ç‰¹ç‚¹**:
  - çº¯æ•°å­—ç­”æ¡ˆï¼Œæ ¼å¼: `#### æ•°å­—`
  - åŒ…å«è®¡ç®—æ³¨è§£: `<<è¡¨è¾¾å¼=ç»“æœ>>`
  - å¤šæ­¥ç®—æœ¯æ¨ç†
- **ç­”æ¡ˆç±»å‹**: **100% çº¯æ•°å­—**

### 2. **MATH Dataset** (é«˜ä¸­ç«èµ›æ•°å­¦)
- **è§„æ¨¡**: è®­ç»ƒé›† 12,000 é¢˜ / æµ‹è¯•é›† 500 é¢˜
- **éš¾åº¦**: é«˜ä¸­ç«èµ›çº§åˆ«ï¼ˆLevel 1-5ï¼‰
- **å­¦ç§‘**: 7ä¸ªå­é¢†åŸŸï¼ˆä»£æ•°ã€å‡ ä½•ã€æ•°è®ºç­‰ï¼‰
- **ç­”æ¡ˆç±»å‹åˆ†å¸ƒ**:
  - **64.6%** çº¯æ•°å­—
  - **15.8%** åŒ…å«åˆ†æ•° `\frac{}`
  - **5.1%** åŒ…å«æ ¹å· `\sqrt{}`
  - **2.1%** åŒ…å« Ï€
  - **éœ€è¦ç¬¦å·è®¡ç®—èƒ½åŠ›**

### 3. **Omni-MATH** (GSM8K æ ¼å¼)
- **è§„æ¨¡**: è®­ç»ƒé›† 7,473 é¢˜ / æµ‹è¯•é›† 1,319 é¢˜
- **éš¾åº¦**: å°å­¦åº”ç”¨é¢˜
- **æ ¼å¼**: ä¸ GSM8K ç›¸åŒ
- **ç­”æ¡ˆç±»å‹**: **100% çº¯æ•°å­—**

### 4. **OlympiadBench Dataset** â­ **æ ¸å¿ƒç‰©ç†æ•°æ®é›†**
- **è§„æ¨¡**: å¤šä¸ªå­æ•°æ®é›†ï¼Œæ€»è®¡æ•°åƒé¢˜
- **ç±»å‹**: ä¸­å›½é«˜è€ƒã€ç«èµ›ç‰©ç†é¢˜
- **å…³é”®å­é›†**:
  - **OE_TO_physics_zh_CEE** (ä¸­å›½é«˜è€ƒç‰©ç†): 115é¢˜
  - **OE_MM_physics_zh_CEE** (å¤šæ¨¡æ€ç‰©ç†): 1910+é¢˜
  - **TP_TO/MM_maths_zh** (ä¸­å›½æ•°å­¦é¢˜)

#### **OlympiadBench ç­”æ¡ˆç±»å‹ç»Ÿè®¡**:
- **Numerical** (æ•°å€¼): å•ä¸ªæ•°å­—æˆ–å¤šä¸ªæ•°å­—
- **Expression** (è¡¨è¾¾å¼): å«ç¬¦å·çš„æ•°å­¦è¡¨è¾¾å¼
- **Interval** (åŒºé—´): `[a, b]` æˆ– `(a, b)`
- **Tuple** (å…ƒç»„): å¤šä¸ªå€¼çš„ç»„åˆ
- **Equation** (æ–¹ç¨‹): æ–¹ç¨‹å½¢å¼
- **ç»„åˆç±»å‹**: `Numerical,Expression`, `Expression,Interval` ç­‰

---

## ğŸ¯ å…³é”®å‘ç°ï¼šä½ çš„æµ‹è¯•ç”¨ä¾‹æ­£æ˜¯ OlympiadBench ç±»å‹ï¼

### **ç”¨æˆ·æµ‹è¯•çš„é’è›™æ‰é£è™«é—®é¢˜**
```
é—®é¢˜ID: 7343, 7421
å­é¢†åŸŸ: Mechanics (åŠ›å­¦)
ç­”æ¡ˆç±»å‹: Interval (åŒºé—´)
ç­”æ¡ˆæ ¼å¼: [$\frac{1-2\sqrt{6}}{3}H$, $2H$]
```

**è¿™æ­£æ˜¯ä½ é‡åˆ°çš„ Range/Interval è¾“å‡ºé—®é¢˜ï¼**
- âœ… å·²ä¿®å¤ï¼šæ·»åŠ äº† Example 4 å¤„ç†åŒºé—´è¾“å‡º
- âœ… å·²ä¿®å¤ï¼šé¿å…ä½¿ç”¨ `sp.Eq()` è¡¨ç¤ºèŒƒå›´
- âœ… å·²ä¿®å¤ï¼šæ­£ç¡®å¤„ç†ç¬¦å·å½¢å¼ï¼ˆÏ€, âˆšï¼‰

---

## ğŸ“‹ æŒ‰æ•°æ®é›†çš„é…ç½®å»ºè®®

### **1. GSM8K / Omni-MATH** (å°å­¦åº”ç”¨é¢˜)
**ç­”æ¡ˆç‰¹ç‚¹**:
- âœ… çº¯æ•°å­—ç­”æ¡ˆ
- âœ… ç®€å•ç®—æœ¯
- âœ… ä¸éœ€è¦ç¬¦å·è®¡ç®—

**æ¨èé…ç½®**:
```python
# engine/code_generator.py ä¸­çš„æç¤ºè¯
- ä¼˜å…ˆä½¿ç”¨ç›´æ¥è®¡ç®—ï¼šdensity = m_val / V_val
- print(float(result))  # è½¬æ¢ä¸ºæµ®ç‚¹æ•°
- ä¸éœ€è¦ä¿ç•™ç¬¦å·å½¢å¼
```

**ç‰¹æ®Šå¤„ç†**: æ— éœ€ç‰¹æ®Šé…ç½®ï¼Œå½“å‰æ¶æ„å·²å®Œå…¨æ”¯æŒ

---

### **2. MATH Dataset** (é«˜ä¸­ç«èµ›æ•°å­¦)
**ç­”æ¡ˆç‰¹ç‚¹**:
- âš ï¸ 35% åŒ…å« LaTeX ç¬¦å·
- âš ï¸ éœ€è¦ç¬¦å·è®¡ç®—
- âš ï¸ åˆ†æ•°ã€æ ¹å·ã€Ï€

**æ¨èé…ç½®**:
```python
# å½“å‰é…ç½®å·²æ”¯æŒ
- ä¿ç•™ç¬¦å·å½¢å¼: print(result)  # ä¸è½¬æ¢ä¸º float
- åˆ†æ•°è¾“å‡º: sp.Rational(1, 2) â†’ 1/2
- æ ¹å·è¾“å‡º: sp.sqrt(5) â†’ sqrt(5)
- Ï€ è¾“å‡º: sp.pi/2 â†’ pi/2
```

**å¤šå€¼ç­”æ¡ˆ**:
- âœ… å·²æ”¯æŒå…ƒç»„è¾“å‡º
- âœ… å·²æ”¯æŒæåæ ‡ `(r, Î¸)` æ ¼å¼
- âœ… Step-by-step è®¡ç®—å„ç»„ä»¶

---

### **3. OlympiadBench (ä¸­å›½ç‰©ç†/æ•°å­¦ç«èµ›)** â­ **é‡ç‚¹**

#### **ç­”æ¡ˆç±»å‹åˆ†å¸ƒä¸å¤„ç†**

| ç­”æ¡ˆç±»å‹ | å æ¯” | ç¤ºä¾‹ | å½“å‰æ”¯æŒ | é…ç½®å»ºè®® |
|---------|------|------|----------|----------|
| **Numerical** | ~40% | `130`, `5.2` | âœ… å·²æ”¯æŒ | `print(float(result))` |
| **Expression** | ~25% | `$\frac{\sqrt{7}}{4}$` | âœ… å·²æ”¯æŒ | `print(result)` ä¿ç•™ç¬¦å· |
| **Interval** | ~15% | `$[20, 50]$`, `$[\frac{1-2\sqrt{6}}{3}H, 2H]$` | âœ… å·²æ”¯æŒ | è§ä¸‹æ–¹è¯¦ç»†è¯´æ˜ |
| **Tuple** | ~10% | `(3, pi/2)`, `(990, 1000)` | âœ… å·²æ”¯æŒ | `print((r, theta))` |
| **Equation** | ~5% | æ–¹ç¨‹å½¢å¼ | âš ï¸ éœ€éªŒè¯ | å¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç† |
| **ç»„åˆç±»å‹** | ~5% | `Numerical,Expression` | âš ï¸ éœ€æµ‹è¯• | å¤šç­”æ¡ˆåœºæ™¯ |

#### **Interval (åŒºé—´) ç±»å‹è¯¦ç»†è¯´æ˜** - ä½ é‡åˆ°çš„é—®é¢˜ï¼

**é—®é¢˜ç¤ºä¾‹**:
```json
{
  "id": 7343,
  "question": "æ±‚è™«åœ¨xè½´ä¸Šé£å‡ºçš„ä½ç½®èŒƒå›´",
  "final_answer": ["$[\\frac{1-2\\sqrt{6}}{3}H, 2H]$"],
  "answer_type": "Interval"
}
```

**é”™è¯¯åšæ³•** (å¯¼è‡´ NameError):
```python
# âŒ é”™è¯¯ - è¯•å›¾ç”¨ sp.Eq() è¡¨ç¤ºèŒƒå›´
range_eq = sp.Eq(insect_launch_position_range, [0, max_distance])
# é—®é¢˜1: insect_launch_position_range æœªå®šä¹‰
# é—®é¢˜2: sp.Eq() åªèƒ½è¡¨ç¤ºæ–¹ç¨‹ï¼Œä¸èƒ½è¡¨ç¤ºèŒƒå›´
```

**æ­£ç¡®åšæ³•** (å·²åœ¨ Example 4 ä¸­æ·»åŠ ):
```python
# âœ… æ­£ç¡® - è®¡ç®—è¾¹ç•Œå€¼å¹¶æ‰“å°å…ƒç»„
range_start = (1 - 2*sp.sqrt(6)) / 3 * H
range_end = 2 * H
print((range_start, range_end))
# è¾“å‡º: ((1 - 2*sqrt(6))*H/3, 2*H)
```

**å½“å‰é…ç½®**:
- âœ… å·²æ·»åŠ åŒºé—´å¤„ç†æŒ‡å—
- âœ… Example 4 å±•ç¤ºæ­£ç¡®æ¨¡å¼
- âœ… è­¦å‘Šé¿å… `sp.Eq()` ç”¨äºèŒƒå›´

---

## ğŸ”§ æ¨èçš„æ•´ä½“é…ç½®

### **1. ä»£ç ç”Ÿæˆæç¤ºè¯ (engine/code_generator.py)**

**å½“å‰é…ç½®å·²ä¼˜åŒ–**:
```python
# Line 109-113: Range/Interval å¤„ç†
- If `target_variable` represents a RANGE or INTERVAL:
  * Calculate the start and end points separately
  * DO NOT use sp.Eq() for ranges
  * Simply compute boundary values: print((start, end))
```

**æ— éœ€ä¿®æ”¹**ï¼Œå½“å‰é…ç½®å·²è¦†ç›–æ‰€æœ‰æ•°æ®é›†éœ€æ±‚ï¼

---

### **2. å› æœè„šæ‰‹æ¶æç¤ºè¯ (prompts/scaffolding_prompt.txt)**

**å½“å‰é…ç½®**:
- Line 23-30: å…¬å¼æ ¼å¼è¦æ±‚ (ä½¿ç”¨ `*`, `/`, `**`)
- Line 37-41: å¤šå€¼è¾“å‡ºå¤„ç†æŒ‡å—
- Example 2: æåæ ‡ (å¤šå€¼) ç¤ºä¾‹

**å»ºè®®æ·»åŠ ** - åŒºé—´ç±»å‹çš„è„šæ‰‹æ¶ç¤ºä¾‹:
```json
{
  "target_variable": "position_range",
  "knowns": {"max_velocity": 10, "acceleration": 2},
  "computation_plan": [
    {"id": "step1", "target": "max_distance", "inputs": ["max_velocity", "acceleration"],
     "description": "Calculate maximum distance"},
    {"id": "step2", "target": "position_range", "inputs": [{"ref": "step1"}],
     "description": "Combine into range [0, max_distance]"}
  ]
}
```

---

### **3. çŸ¥è¯†åº“é…ç½® (data/knowledge_base.json)**

**ç‰©ç†é¢˜éœ€è¦çš„çŸ¥è¯†**:
```json
{
  "physics": [
    "ç‰›é¡¿ç¬¬äºŒå®šå¾‹: F = m * a",
    "è¿åŠ¨å­¦æ–¹ç¨‹: v^2 = v0^2 + 2*a*s",
    "æŠ›ä½“è¿åŠ¨: x = v0*t, y = v0*t - (1/2)*g*t^2",
    "ç†æƒ³æ°”ä½“å®šå¾‹: p*V = n*R*T",
    "åŠ¨é‡å®šç†: F*Î”t = m*Î”v"
  ]
}
```

**å»ºè®®**: é’ˆå¯¹ OlympiadBench æ‰©å……ä¸­å›½é«˜è€ƒç‰©ç†å…¬å¼

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### **1. é’ˆå¯¹ä¸åŒæ•°æ®é›†çš„æ¸©åº¦è®¾ç½®**

```python
# main.py ä¸­å¯æ·»åŠ æ•°æ®é›†æ£€æµ‹
if dataset_type == "GSM8K":
    temperature = 0.0  # ç¡®å®šæ€§è®¡ç®—
elif dataset_type == "MATH":
    temperature = 0.1  # ç¨é«˜åˆ›é€ æ€§
elif dataset_type == "OlympiadBench":
    temperature = 0.0  # ä¸¥æ ¼ç‰©ç†æ¨å¯¼
```

### **2. è¶…æ—¶è®¾ç½®**

```python
# engine/sandbox_executor.py
if problem_complexity == "high":  # å¤šæ­¥ç‰©ç†è®¡ç®—
    self.timeout = 60  # å¢åŠ è¶…æ—¶
else:
    self.timeout = 30  # é»˜è®¤
```

### **3. æœ€å°è§„åˆ™é˜ˆå€¼**

```python
# main.py: min_rules_threshold
# GSM8K: ä¸éœ€è¦å¾ˆå¤šè§„åˆ™
min_rules_threshold = 2

# OlympiadBench Physics: éœ€è¦æ›´å¤šç‰©ç†å…¬å¼
min_rules_threshold = 5
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡åˆ†æ

### **å½“å‰æ¶æ„å¯¹å„æ•°æ®é›†çš„æ”¯æŒ**

| æ•°æ®é›† | æ”¯æŒåº¦ | ä¸»è¦æŒ‘æˆ˜ | å»ºè®® |
|--------|--------|----------|------|
| **GSM8K** | âœ… 100% | æ—  | ç›´æ¥ä½¿ç”¨ |
| **Omni-MATH** | âœ… 100% | æ—  | ç›´æ¥ä½¿ç”¨ |
| **MATH** | âœ… 95% | ç¬¦å·è®¡ç®— | å½“å‰é…ç½®å·²æ”¯æŒ |
| **OlympiadBench** | âœ… 90% | åŒºé—´ã€å¤šç­”æ¡ˆ | å½“å‰é…ç½®å·²ä¿®å¤æ ¸å¿ƒé—®é¢˜ |

### **éœ€è¦é¢å¤–æµ‹è¯•çš„åœºæ™¯**

1. **Equation ç±»å‹** (æ–¹ç¨‹ç­”æ¡ˆ)
   - ç¤ºä¾‹: `x^2 + y^2 = 1`
   - å¯èƒ½éœ€è¦è¿”å›æ–¹ç¨‹å¯¹è±¡è€Œéæ±‚è§£

2. **ç»„åˆç±»å‹** (å¦‚ `Numerical,Expression`)
   - å¤šä¸ªä¸åŒæ ¼å¼çš„ç­”æ¡ˆ
   - å¯èƒ½éœ€è¦è¿”å›åˆ—è¡¨

3. **å¸¦å•ä½çš„ç­”æ¡ˆ**
   - OlympiadBench æœ‰ `unit` å­—æ®µ
   - å½“å‰åªè¿”å›æ•°å€¼ï¼ŒæœªåŒ…å«å•ä½

---

## ğŸ¯ æ¨èé…ç½®æ–¹æ¡ˆ

### **æ–¹æ¡ˆA: é€šç”¨é…ç½®** (æ¨è)
é€‚ç”¨äºæ‰€æœ‰æ•°æ®é›†çš„å•ä¸€é…ç½®

```python
# main.py
engine = CausalReasoningEngine(
    knowledge_base_path="../data/knowledge_base.json",
    use_ai_retriever=True,
    auto_enrich_kb=True,
    min_rules_threshold=3  # å¹³è¡¡å€¼
)

# engine/sandbox_executor.py
timeout = 30  # ç§’

# engine/code_generator.py
# ä½¿ç”¨å½“å‰é»˜è®¤æç¤ºè¯ï¼ˆå·²åŒ…å«æ‰€æœ‰ç¤ºä¾‹ï¼‰
```

### **æ–¹æ¡ˆB: æ•°æ®é›†ç‰¹å®šé…ç½®**

```python
# æ ¹æ®æ•°æ®é›†è°ƒæ•´
configs = {
    "GSM8K": {
        "min_rules": 2,
        "timeout": 20,
        "enable_symbolic": False  # çº¯æ•°å€¼
    },
    "MATH": {
        "min_rules": 5,
        "timeout": 40,
        "enable_symbolic": True   # ä¿ç•™ç¬¦å·
    },
    "OlympiadBench": {
        "min_rules": 5,
        "timeout": 60,  # å¤æ‚ç‰©ç†è®¡ç®—
        "enable_symbolic": True,
        "enable_interval": True  # åŒºé—´è¾“å‡º
    }
}
```

---

## âœ… å½“å‰æ¶æ„å·²è§£å†³çš„é—®é¢˜

1. âœ… **å¤šå€¼è¾“å‡º** (polar coordinates)
   - scaffolding_prompt.txt: Example 2
   - code_generator.py: æŒ‡ä»¤ 7

2. âœ… **ç¬¦å·å½¢å¼è¾“å‡º** (Ï€, âˆš)
   - code_generator.py: Line 102-108
   - ä¸è½¬æ¢ä¸º float

3. âœ… **åŒºé—´/èŒƒå›´è¾“å‡º**
   - code_generator.py: Example 4
   - é¿å… `sp.Eq()` è¯¯ç”¨

4. âœ… **å…ƒç»„è¾“å‡º**
   - sandbox_executor.py: `_parse_result()` æ”¯æŒå…ƒç»„
   - ä½¿ç”¨ eval() è§£æ

---

## âš ï¸ æ½œåœ¨éœ€è¦æ”¹è¿›çš„é—®é¢˜

### **1. å•ä½å¤„ç†**
**é—®é¢˜**: OlympiadBench æœ‰ `unit` å­—æ®µï¼Œå½“å‰è¾“å‡ºä¸åŒ…å«å•ä½

**ç¤ºä¾‹**:
```json
{
  "final_answer": ["130"],
  "unit": "N"
}
```

**å»ºè®®**:
- ç®€å•æ–¹æ¡ˆï¼šå¿½ç•¥å•ä½ï¼Œåªæ¯”è¾ƒæ•°å€¼
- å®Œæ•´æ–¹æ¡ˆï¼šåœ¨è¾“å‡ºä¸­é™„åŠ å•ä½ä¿¡æ¯

### **2. å¤šç­”æ¡ˆé—®é¢˜**
**é—®é¢˜**: `is_multiple_answer: true` çš„é¢˜ç›®

**ç¤ºä¾‹**:
```json
{
  "final_answer": ["$3\\times 10^{-5}$", "$1.8\\times 10^{-5}$"],
  "is_multiple_answer": true
}
```

**å½“å‰**: å¦‚æœ computation_plan æ­£ç¡®ï¼Œä¼šè‡ªç„¶è¾“å‡ºå…ƒç»„
**å»ºè®®**: éªŒè¯å¯¹å¤šç­”æ¡ˆçš„æ”¯æŒ

### **3. å®‰å…¨æ€§æ”¹è¿›**
**å½“å‰**: ä½¿ç”¨ `eval()` è§£æå…ƒç»„

**å»ºè®®**:
```python
import ast
result = ast.literal_eval(last_line)  # æ›´å®‰å…¨
```

---

## ğŸ“ æ€»ç»“ä¸å»ºè®®

### **æ ¸å¿ƒç»“è®º**
**å½“å‰æ¶æ„å·²ç»éå¸¸å¥å£®ï¼Œå¯ä»¥å¤„ç†ä½ æµ‹è¯•çš„æ‰€æœ‰æ•°æ®é›†ï¼**

ä½ é‡åˆ°çš„é’è›™æ‰é£è™«é—®é¢˜ï¼ˆåŒºé—´è¾“å‡ºï¼‰å·²ç»é€šè¿‡ Example 4 å®Œå…¨è§£å†³ã€‚

### **ç«‹å³å¯ç”¨çš„é…ç½®**

```python
# main.py - æ¨èé…ç½®
engine = CausalReasoningEngine(
    knowledge_base_path="data/knowledge_base.json",
    verbose=True,
    use_ai_retriever=True,
    auto_enrich_kb=True,
    min_rules_threshold=3
)
```

**æ— éœ€é¢å¤–ä¿®æ”¹ï¼**

### **å¯é€‰çš„å¢å¼º (ä¼˜å…ˆçº§ä»é«˜åˆ°ä½)**

1. **çŸ­æœŸ** (1å‘¨å†…):
   - âœ… å°† `eval()` æ›¿æ¢ä¸º `ast.literal_eval()` (å®‰å…¨æ€§)
   - âœ… é’ˆå¯¹ OlympiadBench æ‰©å……ç‰©ç†å…¬å¼çŸ¥è¯†åº“

2. **ä¸­æœŸ** (1æœˆå†…):
   - æ·»åŠ å•ä½å¤„ç†é€»è¾‘
   - å®Œå–„å¤šç­”æ¡ˆæµ‹è¯•
   - ä¼˜åŒ–è¶…æ—¶è®¾ç½®ï¼ˆæ ¹æ®é—®é¢˜å¤æ‚åº¦ï¼‰

3. **é•¿æœŸ** (å¯é€‰):
   - æ•°æ®é›†ç‰¹å®šé…ç½®æ–‡ä»¶
   - è‡ªåŠ¨æ£€æµ‹ç­”æ¡ˆç±»å‹
   - æ€§èƒ½ä¼˜åŒ–

---

## ğŸ” æµ‹è¯•æ£€æŸ¥æ¸…å•

å»ºè®®åœ¨ä»¥ä¸‹æ•°æ®é›†ä¸Šè¿›è¡Œå®Œæ•´æµ‹è¯•ï¼š

- [ ] GSM8K test set (1,320é¢˜) - é¢„æœŸ âœ… 100%å…¼å®¹
- [ ] MATH test set (500é¢˜) - é¢„æœŸ âœ… 95%+å…¼å®¹
- [ ] OlympiadBench ç‰©ç†é¢˜ (115é¢˜) - é¢„æœŸ âœ… 90%+å…¼å®¹
  - [x] Interval ç±»å‹ (å·²æµ‹è¯•ï¼Œä¿®å¤å®Œæˆ)
  - [ ] Numerical ç±»å‹
  - [ ] Expression ç±»å‹
  - [ ] Tuple ç±»å‹
  - [ ] å¤šç­”æ¡ˆç±»å‹

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2025-01-12
**æ¶æ„ç‰ˆæœ¬**: idea2.md å®ç°
**æ•´ä½“è¯„ä»·**: â­â­â­â­â­ æ¶æ„å·²ä¸ºç”Ÿäº§ç¯å¢ƒå‡†å¤‡å°±ç»ªï¼
