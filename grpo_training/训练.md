# GRPO Training è¯¦ç»†æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
5. [å…³é”®ç»„ä»¶è¯¦è§£](#å…³é”®ç»„ä»¶è¯¦è§£)
6. [è®­ç»ƒè¿‡ç¨‹](#è®­ç»ƒè¿‡ç¨‹)
7. [å¥–åŠ±æœºåˆ¶](#å¥–åŠ±æœºåˆ¶)
8. [ç»éªŒæå–](#ç»éªŒæå–)
9. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è¿°

GRPO Training æ˜¯ä¸€ä¸ªåŸºäºå› æœæ¨ç†çš„å¤šæ™ºèƒ½ä½“è®­ç»ƒæ¡†æ¶ï¼Œç”¨äºæå‡æ•°å­¦å’Œç‰©ç†é—®é¢˜çš„è§£é¢˜èƒ½åŠ›ã€‚ç³»ç»Ÿé‡‡ç”¨**Training-Free GRPO (Group Relative Policy Optimization)** æ–¹æ³•ï¼Œé€šè¿‡å¤šä¸ªç”Ÿæˆå™¨å’Œæ‰¹åˆ¤è€…çš„åä½œå­¦ä¹ ï¼Œé€æ­¥ç§¯ç´¯è§£é¢˜ç»éªŒã€‚

### ğŸ¯ è®­ç»ƒç›®æ ‡
- æå‡LLMåœ¨å¤æ‚æ•°å­¦/ç‰©ç†é—®é¢˜ä¸Šçš„è§£é¢˜å‡†ç¡®ç‡
- å­¦ä¹ å› æœæ¨ç†å’Œé—®é¢˜åˆ†è§£èƒ½åŠ›
- ç§¯ç´¯è§£é¢˜ç»éªŒå’Œç­–ç•¥

### ğŸ“Š è®­ç»ƒæ•°æ®
- **æ€»é¢˜æ•°**: 90é“é¢˜ç›®
- **æ•°æ®æ¥æº**:
  - AIME2024: 30é“æ•°å­¦ç«èµ›é¢˜
  - AIME2025: 30é“æ•°å­¦ç«èµ›é¢˜
  - Physics: 30é“ç‰©ç†é¢˜

---

## æ ¸å¿ƒæ¦‚å¿µ

### 1. Generator (ç”Ÿæˆå™¨)
ä¸‰ä¸ªç‹¬ç«‹çš„ç”Ÿæˆå™¨ï¼Œæ¯ä¸ªè´Ÿè´£ç”Ÿæˆå› æœå›¾å’Œè§£ç­”ï¼š

- **Generator 1**: åŸºç¡€ç”Ÿæˆå™¨ï¼Œä½¿ç”¨æ ‡å‡†å¥–åŠ±æƒé‡
- **Generator 2**: ä¾§é‡ç­”æ¡ˆæ­£ç¡®æ€§çš„ç”Ÿæˆå™¨
- **Generator 3**: ä¾§é‡ç­”æ¡ˆæ­£ç¡®æ€§çš„ç”Ÿæˆå™¨

### 2. Critic (æ‰¹åˆ¤è€…)
è´Ÿè´£èåˆå¤šä¸ªç”Ÿæˆå™¨çš„ç»“æœï¼Œé€‰æ‹©æœ€ä¼˜è§£ï¼š
- æ¥æ”¶3ä¸ªç”Ÿæˆå™¨å„è‡ªçš„3ä¸ªrollouts
- ä½¿ç”¨LLMè¿›è¡Œæ™ºèƒ½èåˆ
- è®¡ç®—èåˆè´¨é‡å¥–åŠ±

### 3. Rollout (æ¨æ¼”)
å¯¹äºæ¯ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªç”Ÿæˆå™¨äº§ç”Ÿ3ä¸ªrolloutsï¼š
- **Rollout 1**: ç¬¬ä¸€ä¸ªè§£é¢˜å°è¯•
- **Rollout 2**: ç¬¬äºŒä¸ªè§£é¢˜å°è¯•
- **Rollout 3**: ç¬¬ä¸‰ä¸ªè§£é¢˜å°è¯•

### 4. GRPOç»éªŒ
ä»æˆåŠŸçš„rolloutsä¸­æå–çš„è§£é¢˜ç»éªŒå’Œç­–ç•¥ã€‚

---

## æ¶æ„è®¾è®¡

```mermaid
graph TD
    A[90é“é¢˜ç›®] --> B[Generator 1]
    A --> C[Generator 2]
    A --> D[Generator 3]

    B --> E[3ä¸ªRollouts]
    C --> F[3ä¸ªRollouts]
    D --> G[3ä¸ªRollouts]

    E --> H[Criticèåˆ1]
    F --> I[Criticèåˆ2]
    G --> J[Criticèåˆ3]

    H --> K[æœ€ç»ˆç»“æœ1]
    I --> L[æœ€ç»ˆç»“æœ2]
    J --> M[æœ€ç»ˆç»“æœ3]

    E --> N[Generator 1ç»éªŒ]
    F --> O[Generator 2ç»éªŒ]
    G --> P[Generator 3ç»éªŒ]
    H --> I --> J --> Q[Criticç»éªŒ]
```

### æ–‡ä»¶ç»“æ„
```
grpo_training/
â”œâ”€â”€ generator1.py          # Generator 1 åŸå§‹ç‰ˆ
â”œâ”€â”€ generator1_simple.py    # Generator 1 ç®€åŒ–ç‰ˆ â­
â”œâ”€â”€ generator2.py          # Generator 2 åŸå§‹ç‰ˆ
â”œâ”€â”€ generator2_simple.py    # Generator 2 ç®€åŒ–ç‰ˆ â­
â”œâ”€â”€ generator3.py          # Generator 3 åŸå§‹ç‰ˆ
â”œâ”€â”€ generator3_simple.py    # Generator 3 ç®€åŒ–ç‰ˆ â­
â”œâ”€â”€ critic.py              # Critic åŸå§‹ç‰ˆ
â”œâ”€â”€ critic_simple.py        # Critic ç®€åŒ–ç‰ˆ â­
â”œâ”€â”€ experience_extractor.py # ç»éªŒæå–å™¨
â”œâ”€â”€ dataset_config.json     # æ•°æ®é›†é…ç½®
â””â”€â”€ cache/                  # ç»“æœç¼“å­˜ç›®å½•
```

---

## æ•°æ®æµç¨‹

### 1. æ•°æ®åŠ è½½æµç¨‹

```python
def load_problems(dataset="full", max_problems=None):
    # 1. è¯»å–é…ç½®æ–‡ä»¶ dataset_config.json
    # 2. åŠ è½½ AIME2024: 30é¢˜ (JSONLæ ¼å¼)
    # 3. åŠ è½½ AIME2025: 30é¢˜ (JSONLæ ¼å¼)
    # 4. åŠ è½½ Physics: 30é¢˜ (JSONæ ¼å¼)
    # 5. è¿”å›ç»Ÿä¸€æ ¼å¼çš„é—®é¢˜åˆ—è¡¨
```

**æ•°æ®æ ¼å¼ç»Ÿä¸€åŒ–**ï¼š
```json
{
    "id": "aime2024_001",
    "text": "é¢˜ç›®å†…å®¹...",
    "answer": "ç­”æ¡ˆ..."
}
```

### 2. è®­ç»ƒæµç¨‹

```
é˜¶æ®µ1: Generatorè®­ç»ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯ä¸ªGeneratorç‹¬ç«‹å¤„ç†æ‰€æœ‰é¢˜ç›®              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ Generator 1  â”‚ â”‚ Generator 2  â”‚ â”‚ Generator 3 â”‚
â”‚ â”‚ 90é¢˜ Ã— 3rollout â”‚ â”‚ 90é¢˜ Ã— 3rollout â”‚ â”‚ 90é¢˜ Ã— 3rollout â”‚
â”‚ â”‚ = 270ä¸ªrollout â”‚ â”‚ = 270ä¸ªrollout â”‚ â”‚ = 270ä¸ªrollout â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ æå–ç»éªŒ
é˜¶æ®µ2: Criticè®­ç»ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èåˆæ¯ä¸ªGeneratorçš„rollouts               â”‚
â”‚ Generator 1: 270 â†’ 90ä¸ªèåˆç»“æœ           â”‚
â”‚ Generator 2: 270 â†’ 90ä¸ªèåˆç»“æœ           â”‚
â”‚ Generator 3: 270 â†’ 90ä¸ªèåˆç»“æœ           â”‚
â”‚ æ€»è®¡: 270ä¸ªèåˆç»“æœ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ æå–ç»éªŒ
```

---

## å…³é”®ç»„ä»¶è¯¦è§£

### 1. Generator (ç”Ÿæˆå™¨)

#### æ ¸å¿ƒåŠŸèƒ½
```python
def generate_rollouts(problem, scaffolder, computer, evaluator, extractor):
    """
    ä¸ºä¸€é“é¢˜ç”Ÿæˆ3ä¸ªrolloutså¹¶è®¡ç®—å¥–åŠ±
    """
    # 1. åŠ è½½å½“å‰ç»éªŒåº“
    experiences = extractor._load_experiences(GENERATOR_ID)

    # 2. ç”Ÿæˆ3ä¸ªrollouts
    for i in range(1, 4):
        # ç”Ÿæˆå› æœå›¾
        scaffold = scaffolder.generate_scaffold(
            problem_text=problem['text'],
            experiences=experiences
        )

        # è®¡ç®—ç­”æ¡ˆ
        answer = computer.compute_from_scaffold(scaffold, problem['text'])

        # è®¡ç®—å¥–åŠ±
        rewards = calculate_rewards(scaffold, answer, problem, evaluator)
```

#### ç»éªŒæ³¨å…¥æœºåˆ¶
- **åŠ¨æ€åŠ è½½**: æ¯ä¸ªé—®é¢˜å‰åŠ è½½æœ€æ–°çš„ç»éªŒåº“
- **ç»éªŒæ ¼å¼**: JSONæ ¼å¼çš„è§£é¢˜ç»éªŒå’Œç­–ç•¥
- **ç»éªŒæ¥æº**: ä»ä¹‹å‰æˆåŠŸçš„rolloutsä¸­æå–

### 2. Critic (æ‰¹åˆ¤è€…)

#### èåˆç®—æ³•
```python
def fuse_rollouts(rollouts, llm_client, problem_text):
    """
    èåˆ3ä¸ªrolloutsç”Ÿæˆæœ€ä¼˜è§£
    """
    # 1. æå–3ä¸ªscaffolds
    proposals = [r['scaffold'] for r in rollouts]

    # 2. ä½¿ç”¨LLMè¿›è¡Œæ™ºèƒ½èåˆ
    fusion_prompt = format_prompt(problem_text, proposals)
    response = llm_client.complete(fusion_prompt)

    # 3. è§£æèåˆç»“æœ
    fused_scaffold = parse_fused_scaffold(response)

    return fused_scaffold
```

#### èåˆPromptç»“æ„
```
é—®é¢˜: [é¢˜ç›®å†…å®¹]

ç»éªŒ: [Criticç»éªŒåº“]

ææ¡ˆ1: [Rollout 1çš„scaffold]
ææ¡ˆ2: [Rollout 2çš„scaffold]
ææ¡ˆ3: [Rollout 3çš„scaffold]

è¯·èåˆä»¥ä¸Šä¸‰ä¸ªææ¡ˆï¼Œç”Ÿæˆæœ€ä¼˜çš„è§£é¢˜æ–¹æ¡ˆã€‚
```

### 3. Experience Extractor (ç»éªŒæå–å™¨)

#### è§¦å‘æ¡ä»¶
```python
def should_extract_experience(rewards, tau=0.05):
    """
    åˆ¤æ–­æ˜¯å¦åº”è¯¥æå–ç»éªŒ
    """
    reward_values = [r['r_total'] for r in rewards]
    mean_reward = sum(reward_values) / len(reward_values)
    std_reward = calculate_std(reward_values)

    # å½“æ ‡å‡†å·® > é˜ˆå€¼æ—¶æå–ç»éªŒ
    return std_reward > tau
```

#### ç»éªŒæå–é€»è¾‘
- **æˆåŠŸç»éªŒ**: ä»é«˜å¥–åŠ±rolloutsä¸­æå–
- **å¤±è´¥ç»éªŒ**: ä»ä½å¥–åŠ±rolloutsä¸­å­¦ä¹ é¿å…ç­–ç•¥
- **åˆ†ç±»æ ‡ç­¾**: æŒ‰é—®é¢˜ç±»å‹å’Œè§£é¢˜ç­–ç•¥åˆ†ç±»

---

## è®­ç»ƒè¿‡ç¨‹

### é˜¶æ®µ1: Generatorè®­ç»ƒ

#### æ­¥éª¤1.1: åˆå§‹åŒ–
```bash
# Generator 1
python grpo_training/generator1_simple.py

# Generator 2
python grpo_training/generator2_simple.py

# Generator 3
python grpo_training/generator3_simple.py
```

#### æ­¥éª¤1.2: è®­ç»ƒå¾ªç¯
```
å¯¹äºæ¯é“é¢˜ç›® (1-90):
    1. æ˜¾ç¤ºå½“å‰ç»éªŒåº“å¤§å°
    2. åŠ è½½å½“å‰ç»éªŒ
    3. ç”Ÿæˆ3ä¸ªrollouts:
       - Rollout 1: ç”Ÿæˆå› æœå›¾ + è®¡ç®—ç­”æ¡ˆ
       - Rollout 2: ç”Ÿæˆå› æœå›¾ + è®¡ç®—ç­”æ¡ˆ
       - Rollout 3: ç”Ÿæˆå› æœå›¾ + è®¡ç®—ç­”æ¡ˆ
    4. è®¡ç®—æ¯ä¸ªrolloutçš„å¥–åŠ±
    5. ä¿å­˜rolloutsåˆ°ç¼“å­˜æ–‡ä»¶
    6. æå–ç»éªŒ (å¦‚æœæ»¡è¶³æ¡ä»¶)
    7. æ›´æ–°ç»éªŒåº“
    8. æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
```

#### é˜¶æ®µ1è¾“å‡º
- **Rolloutsæ–‡ä»¶**: `cache/generator_1_rollouts.jsonl`
- **ç»éªŒæ–‡ä»¶**: `data/grpo_experiences/generator_1_experiences.json`

### é˜¶æ®µ2: Criticè®­ç»ƒ

#### æ­¥éª¤2.1: æ•°æ®å‡†å¤‡
```python
# åŠ è½½æ‰€æœ‰Generatorçš„rollouts
gen1_rollouts = load_generator_rollouts('generator_1')  # 90é¢˜ Ã— 3rollout
gen2_rollouts = load_generator_rollouts('generator_2')  # 90é¢˜ Ã— 3rollout
gen3_rollouts = load_generator_rollouts('generator_3')  # 90é¢˜ Ã— 3rollout
```

#### æ­¥éª¤2.2: èåˆå¾ªç¯
```bash
python grpo_training/critic_simple.py
```

```
å¯¹äºæ¯é“é¢˜ç›® (1-90):
    1. æ˜¾ç¤ºå½“å‰ç»éªŒåº“å¤§å°
    2. å¯¹æ¯ä¸ªGeneratorè¿›è¡Œèåˆ:
       - Generator 1: èåˆå…¶3ä¸ªrollouts â†’ 1ä¸ªæœ€ä¼˜è§£
       - Generator 2: èåˆå…¶3ä¸ªrollouts â†’ 1ä¸ªæœ€ä¼˜è§£
       - Generator 3: èåˆå…¶3ä¸ªrollouts â†’ 1ä¸ªæœ€ä¼˜è§£
    3. è®¡ç®—èåˆå¥–åŠ± (åŒ…å«r_fusion)
    4. ä¿å­˜èåˆç»“æœ
    5. æå–Criticç»éªŒ
    6. æ›´æ–°ç»éªŒåº“
```

#### é˜¶æ®µ2è¾“å‡º
- **èåˆç»“æœ**: `cache/critic_results.jsonl`
- **Criticç»éªŒ**: `data/grpo_experiences/critic_experiences.json`

---

## å¥–åŠ±æœºåˆ¶

### å¥–åŠ±ç»„æˆ
æ¯ä¸ªrollout/èåˆç»“æœéƒ½æœ‰4ä¸ªå¥–åŠ±åˆ†é‡ï¼š

#### 1. r_ans (ç­”æ¡ˆæ­£ç¡®æ€§)
```python
r_ans = evaluator.evaluate_answer(
    predicted_answer=answer,
    ground_truth=problem['answer'],
    problem_text=problem['text']
)
# èŒƒå›´: [0.0, 1.0], 1.0è¡¨ç¤ºå®Œå…¨æ­£ç¡®
```

#### 2. r_logic (é€»è¾‘è´¨é‡)
```python
r_logic = evaluator.evaluate_logic(
    trajectory=str(scaffold),
    problem_text=problem['text']
)
# èŒƒå›´: [0.0, 1.0], è¯„ä¼°æ¨ç†é€»è¾‘çš„åˆç†æ€§
```

#### 3. r_graph (å›¾è´¨é‡)
```python
r_graph = evaluator.evaluate_graph(scaffold)
# èŒƒå›´: [0.0, 1.0], è¯„ä¼°å› æœå›¾ç»“æ„çš„è´¨é‡
```

#### 4. r_fusion (èåˆè´¨é‡) - ä»…Critic
```python
r_fusion = evaluator.evaluate_fusion(
    proposals=[r1['scaffold'], r2['scaffold'], r3['scaffold']],
    fused_result=fused_scaffold,
    ground_truth=problem['answer']
)
# èŒƒå›´: [0.0, 1.0], è¯„ä¼°èåˆæ˜¯å¦ä¼˜äºåŸå§‹ææ¡ˆ
```

### æ€»å¥–åŠ±è®¡ç®—

#### Generatoræƒé‡
```python
r_total = 0.5 * r_ans + 0.25 * r_logic + 0.25 * r_graph
```

#### Criticæƒé‡
```python
r_total = 0.3 * r_ans + 0.2 * r_logic + 0.2 * r_graph + 0.3 * r_fusion
```

### å¥–åŠ±ç¤ºä¾‹
```
Generator Rollout:
  r_ans: 1.000 (ç­”æ¡ˆæ­£ç¡®)
  r_logic: 0.850 (é€»è¾‘å¾ˆå¥½)
  r_graph: 0.900 (å›¾ç»“æ„ä¼˜ç§€)
  r_total: 0.938 (æ€»å¥–åŠ±å¾ˆé«˜)

Critic Fusion:
  r_ans: 1.000 (èåˆåç­”æ¡ˆæ­£ç¡®)
  r_logic: 0.900 (èåˆé€»è¾‘ä¼˜ç§€)
  r_graph: 0.950 (èåˆå›¾ç»“æ„å¾ˆå¥½)
  r_fusion: 0.800 (èåˆè´¨é‡è‰¯å¥½)
  r_total: 0.910 (æ€»å¥–åŠ±å¾ˆé«˜)
```

---

## ç»éªŒæå–

### æå–æ—¶æœº
```python
def extract_generator_experience(generator_id, problem, rollouts, ground_truth):
    """
    Generatorç»éªŒæå–æ¡ä»¶
    """
    rewards = [r['r_total'] for r in rollouts]

    # è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡
    mean_reward = sum(rewards) / len(rewards)
    std_reward = calculate_std(rewards)
    max_reward = max(rewards)

    # æå–æ¡ä»¶
    if std_reward > 0.05:  # ç»éªŒæ–¹å·®å¤§
        # æˆ– max_reward > 0.8  # æœ‰å¾ˆå¥½çš„è§£æ³•
        extract_experience()
```

### ç»éªŒç±»å‹

#### 1. æˆåŠŸç»éªŒ
```json
{
    "id": "G1-001",
    "content": "å¯¹äºäºŒæ¬¡æ–¹ç¨‹é—®é¢˜ï¼Œå…ˆè¯†åˆ«åˆ¤åˆ«å¼ï¼Œç„¶åæ ¹æ®åˆ¤åˆ«å¼ç¬¦å·ç¡®å®šè§£çš„æ€§è´¨",
    "category": "problem_solving_strategy",
    "success_count": 3,
    "usage_count": 5,
    "problem_type": "math_algebra"
}
```

#### 2. å¤±è´¥ç»éªŒ
```json
{
    "id": "G1-002",
    "content": "é¿å…åœ¨ç‰©ç†é—®é¢˜ä¸­å¿½ç•¥å•ä½è½¬æ¢ï¼Œè¿™ä¼šå¯¼è‡´è®¡ç®—é”™è¯¯",
    "category": "common_mistake",
    "success_count": 0,
    "usage_count": 2,
    "problem_type": "physics_unit_conversion"
}
```

### ç»éªŒåº“ç»“æ„
```
data/grpo_experiences/
â”œâ”€â”€ shared_experiences.json      # æ‰€æœ‰æ™ºèƒ½ä½“å…±äº«çš„ç»éªŒ
â”œâ”€â”€ generator_1_experiences.json  # Generator 1ä¸“ç”¨ç»éªŒ
â”œâ”€â”€ generator_2_experiences.json  # Generator 2ä¸“ç”¨ç»éªŒ
â”œâ”€â”€ generator_3_experiences.json  # Generator 3ä¸“ç”¨ç»éªŒ
â””â”€â”€ critic_experiences.json       # Criticä¸“ç”¨ç»éªŒ
```

---

## ä½¿ç”¨æŒ‡å—

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### æ­¥éª¤1: å‡†å¤‡ç¯å¢ƒ
```bash
# ç¡®ä¿APIå¯†é’¥é…ç½®æ­£ç¡®
ls data/api_keys/api_config.json

# æ£€æŸ¥æ•°æ®é›†é…ç½®
cat grpo_training/dataset_config.json
```

#### æ­¥éª¤2: Generatorè®­ç»ƒ (æ¨èç®€åŒ–ç‰ˆ)
```bash
# å¹¶è¡Œè¿è¡Œä¸‰ä¸ªGenerator (3ä¸ªç»ˆç«¯)
python grpo_training/generator1_simple.py --dataset full
python grpo_training/generator2_simple.py --dataset full
python grpo_training/generator3_simple.py --dataset full
```

#### æ­¥éª¤3: Criticè®­ç»ƒ
```bash
# Generatorè®­ç»ƒå®Œæˆåè¿è¡ŒCritic
python grpo_training/critic_simple.py
```

### ğŸ”§ é«˜çº§ç”¨æ³•

#### è‡ªå®šä¹‰è®­ç»ƒå‚æ•°
```bash
# é™åˆ¶é¢˜ç›®æ•°é‡ (ç”¨äºæµ‹è¯•)
python grpo_training/generator1_simple.py --max-problems 10

# è°ƒæ•´rolloutæ•°é‡
python grpo_training/generator1_simple.py --rollouts 5

# è°ƒæ•´ç”Ÿæˆæ¸©åº¦
python grpo_training/generator1_simple.py --temperature 0.5
```

#### å•ç‹¬æ•°æ®é›†è®­ç»ƒ
```bash
# åªè®­ç»ƒAIME2024
python grpo_training/generator1_simple.py --dataset aime2024

# åªè®­ç»ƒç‰©ç†é¢˜
python grpo_training/generator1_simple.py --dataset physics
```

### ğŸ“Š ç›‘æ§è®­ç»ƒè¿›åº¦

#### å®æ—¶æ—¥å¿—
```
--- é¢˜ç›® 1/90: aime2024_001 ---
å½“å‰ç»éªŒåº“: 0 æ¡
  ç”ŸæˆRollout 1...
  âœ“ Rollout 1: æ­£ç¡® (å¥–åŠ±: 0.85)
  ç”ŸæˆRollout 2...
  âœ“ Rollout 2: é”™è¯¯ (å¥–åŠ±: 0.42)
  ç”ŸæˆRollout 3...
  âœ“ Rollout 3: æ­£ç¡® (å¥–åŠ±: 0.78)
æœ¬é¢˜ç›®æ­£ç¡®ç‡: 2/3 = 66.7%
æ›´æ–°åç»éªŒåº“: 1 æ¡
```

#### ç»“æœæ–‡ä»¶æŸ¥çœ‹
```bash
# æŸ¥çœ‹Generator 1çš„rollouts
head -n 1 grpo_training/cache/generator_1_rollouts.jsonl | jq '.'

# æŸ¥çœ‹Criticçš„èåˆç»“æœ
head -n 1 grpo_training/cache/critic_results.jsonl | jq '.'
```

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

#### å¹¶è¡Œè®­ç»ƒ
```bash
# ä½¿ç”¨GNU Parallelå¹¶è¡Œè®­ç»ƒ
parallel -j 3 python grpo_training/generator{}_simple.py ::: 1 2 3
```

#### æ–­ç‚¹ç»­è®­
```bash
# ä»ç¬¬50é¢˜ç»§ç»­è®­ç»ƒ
python grpo_training/generator1_simple.py --max-problems 40 --start-problem 50
```

---

## å¸¸è§é—®é¢˜

### Q1: è®­ç»ƒå¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ
**A**:
- ä½¿ç”¨ç®€åŒ–ç‰ˆè„šæœ¬ (`*_simple.py`)
- å‡å°‘rolloutæ•°é‡ (`--rollouts 2`)
- é™åˆ¶é¢˜ç›®æ•°é‡ (`--max-problems 10` ç”¨äºæµ‹è¯•)
- å¹¶è¡Œè¿è¡ŒGenerator

### Q2: å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ
**A**:
- å‡å°‘å¹¶å‘æ•°é‡
- åˆ†æ‰¹è®­ç»ƒï¼Œæ¯æ¬¡å¤„ç†éƒ¨åˆ†é¢˜ç›®
- æ¸…ç†ç¼“å­˜æ–‡ä»¶

### Q3: ç»éªŒåº“å¢é•¿è¿‡å¿«æ€ä¹ˆåŠï¼Ÿ
**A**:
- è°ƒæ•´ç»éªŒæå–é˜ˆå€¼ (`tau`)
- å®šæœŸæ¸…ç†ä½è´¨é‡ç»éªŒ
- é™åˆ¶æœ€å¤§ç»éªŒæ•°é‡

### Q4: å¦‚ä½•è¯„ä¼°è®­ç»ƒæ•ˆæœï¼Ÿ
**A**:
```bash
# æŸ¥çœ‹å¹³å‡å¥–åŠ±
python -c "
import json
with open('grpo_training/cache/generator_1_rollouts.jsonl') as f:
    rewards = []
    for line in f:
        data = json.loads(line)
        for r in data['rollouts']:
            rewards.append(r.get('r_total', 0))
    print(f'å¹³å‡å¥–åŠ±: {sum(rewards)/len(rewards):.3f}')
    print(f'æ­£ç¡®ç‡: {sum(1 for r in rewards if r > 0.8)/len(rewards):.2%}')
"
```

### Q5: å¦‚ä½•è°ƒè¯•è®­ç»ƒè¿‡ç¨‹ï¼Ÿ
**A**:
```bash
# å•é¢˜è°ƒè¯•
python grpo_training/generator1_simple.py --max-problems 1

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
python grpo_training/generator1.py --verbose

# æ£€æŸ¥ç»éªŒåº“å†…å®¹
python -c "
import json
with open('data/grpo_experiences/generator_1_experiences.json') as f:
    exp = json.load(f)
    print(f'ç»éªŒæ•°é‡: {len(exp)}')
    if exp:
        print(f'æœ€æ–°ç»éªŒ: {exp[-1][\"content\"]}')
"
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [AIMEæ•°å­¦ç«èµ›](https://artofproblemsolving.com/wiki/index.php/AIME_Problems_and_Solutions)
- [å› æœæ¨ç†](https://en.wikipedia.org/wiki/Causal_inference)
- [GRPOè®ºæ–‡](https://arxiv.org/abs/2402.14740)
- [å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ](https://en.wikipedia.org/wiki/Multi-agent_system)

---

*æœ€åæ›´æ–°: 2025å¹´1æœˆ*