# RAGçŸ¥è¯† vs GRPOç»éªŒï¼šå‚æ•°åˆ†ç¦»è®¾è®¡è¯´æ˜

## ğŸ“‹ **ä¿®æ”¹æ¦‚è¿°**

ä¸ºäº†æ¸…æ™°åŒºåˆ†**RAGæ£€ç´¢çŸ¥è¯†**å’Œ**GRPOè®­ç»ƒç»éªŒ**ï¼Œæˆ‘ä»¬å®ç°äº†å‚æ•°åˆ†ç¦»è®¾è®¡ï¼Œç¡®ä¿ä¸¤è€…ç‹¬ç«‹ç®¡ç†ã€èŒè´£æ˜ç¡®ã€‚

---

## ğŸ¯ **æ ¸å¿ƒä¿®æ”¹**

### 1. **`engine/scaffolder.py` - å‚æ•°åˆ†ç¦»**

#### ä¿®æ”¹å‰ï¼ˆæ··ç”¨ï¼‰ï¼š
```python
def generate_scaffold(
    self,
    problem_text: str,
    retrieved_knowledge: List[str]  # RAGå’Œç»éªŒæ··åœ¨ä¸€èµ·
) -> Optional[Dict[str, Any]]:
```

#### ä¿®æ”¹åï¼ˆåˆ†ç¦»ï¼‰ï¼š
```python
def generate_scaffold(
    self,
    problem_text: str,
    retrieved_knowledge: List[str],      # RAGæ£€ç´¢çš„çŸ¥è¯†ï¼ˆå…¬å¼ã€å®šç†ï¼‰
    experiences: Optional[List[str]] = None  # GRPOè®­ç»ƒè·å¾—çš„ç»éªŒ
) -> Optional[Dict[str, Any]]:
```

**å˜åŒ–ï¼š**
- âœ… æ–°å¢ `experiences` å‚æ•°
- âœ… ä¸¤è€…åœ¨promptä¸­åˆ†åˆ«å‘ˆç°
- âœ… ä¸¤è€…å¯ä»¥ç‹¬ç«‹å¯ç”¨/ç¦ç”¨

---

### 2. **`prompts/scaffolding_prompt_v3.txt` - Promptæ›´æ–°**

#### ä¿®æ”¹å‰ï¼š
```
CONTEXT:
Here are relevant formulas and theorems:
{retrieved_knowledge}
```

#### ä¿®æ”¹åï¼š
```
CONTEXT:

**Relevant formulas and theorems (from knowledge base):**
{retrieved_knowledge}

**Prior experiences (learned from previous problems):**
{prior_experiences}
```

**å˜åŒ–ï¼š**
- âœ… æ˜ç¡®æ ‡æ³¨çŸ¥è¯†æ¥æº
- âœ… åˆ†å¼€æ˜¾ç¤ºRAGçŸ¥è¯†å’ŒGRPOç»éªŒ
- âœ… LLMæ›´å®¹æ˜“ç†è§£ä¸¤è€…çš„åŒºåˆ«

---

### 3. **GRPOè®­ç»ƒè„šæœ¬ - åŠ¨æ€åŠ è½½ç»éªŒ**

#### ä¿®æ”¹å‰ï¼ˆä¸åŠ è½½ç»éªŒï¼‰ï¼š
```python
scaffold = scaffolder.generate_scaffold(
    problem_text=problem['text'],
    retrieved_knowledge=[]  # ç©ºçš„ï¼Œæ²¡æœ‰ç»éªŒ
)
```

#### ä¿®æ”¹åï¼ˆåŠ¨æ€åŠ è½½ç»éªŒï¼‰ï¼š
```python
# åŠ¨æ€åŠ è½½å½“å‰ç»éªŒåº“
experiences_list = experience_extractor._load_experiences(generator_id)
experiences = [exp['content'] for exp in experiences_list]

# ç”Ÿæˆscaffoldæ—¶ä¼ å…¥ç»éªŒ
scaffold = scaffolder.generate_scaffold(
    problem_text=problem['text'],
    retrieved_knowledge=[],  # RAGçŸ¥è¯†ï¼ˆç›®å‰ç¦ç”¨ï¼‰
    experiences=experiences  # GRPOç»éªŒï¼ˆåŠ¨æ€åŠ è½½ï¼‰
)
```

**å˜åŒ–ï¼š**
- âœ… æ¯ä¸ªrolloutä¹‹å‰åŠ¨æ€åŠ è½½æœ€æ–°ç»éªŒåº“
- âœ… è®­ç»ƒè¿‡ç¨‹ä¸­ç»éªŒåº“å®æ—¶æ›´æ–°ï¼Œä¸‹ä¸ªé—®é¢˜ç«‹å³ä½¿ç”¨
- âœ… æ˜¾ç¤ºç»éªŒåº“å¤§å°å˜åŒ–ï¼ˆè®­ç»ƒå‰åå¯¹æ¯”ï¼‰

**è®­ç»ƒè¾“å‡ºç¤ºä¾‹ï¼š**
```
[Problem 1/10] Current experience library: 0 items
   â†’ Updated experience library: 2 items

[Problem 2/10] Current experience library: 2 items
   â†’ Updated experience library: 3 items  (add 1ä¸ª)

[Problem 3/10] Current experience library: 3 items
   â†’ Updated experience library: 3 items  (modifyäº†1ä¸ªï¼Œæ²¡æœ‰æ–°å¢)
```

---

## ğŸ“Š **å®Œæ•´æ•°æ®æµ**

### Trainingæ—¶çš„æµç¨‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Problem N                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: åŠ è½½å½“å‰ç»éªŒåº“                                        â”‚
â”‚   experiences = load_experiences(generator_id)                â”‚
â”‚   å½“å‰: [E1, E2, E3] (3æ¡ç»éªŒ)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ç”Ÿæˆ3ä¸ªRolloutsï¼ˆä½¿ç”¨ç»éªŒåº“ï¼‰                        â”‚
â”‚   for i in 1..3:                                              â”‚
â”‚     scaffold = generate_scaffold(                             â”‚
â”‚         problem_text=problem,                                 â”‚
â”‚         retrieved_knowledge=[],  # RAG disabled              â”‚
â”‚         experiences=[E1, E2, E3]  # GRPO enabled             â”‚
â”‚     )                                                         â”‚
â”‚   â†’ Rollout 1: r_total=0.95                                  â”‚
â”‚   â†’ Rollout 2: r_total=0.30                                  â”‚
â”‚   â†’ Rollout 3: r_total=0.85                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: åˆ†æå·®å¼‚ï¼Œæå–ç»éªŒï¼ˆGRPOï¼‰                           â”‚
â”‚   LLMåˆ†æ â†’ å†³å®šæ“ä½œ:                                         â”‚
â”‚     - modify E2 (ä¸å¤Ÿå‡†ç¡®)                                    â”‚
â”‚     - add E4 (å‘ç°æ–°é”™è¯¯)                                     â”‚
â”‚     - delete E1 (å·²è¿‡æ—¶)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: æ›´æ–°ç»éªŒåº“                                            â”‚
â”‚   æ–°ç»éªŒåº“: [E2(updated), E3, E4]                            â”‚
â”‚   ä¿å­˜åˆ°: data/grpo_experiences/generator_1_experiences.json â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Problem N+1                                                   â”‚
â”‚   åŠ è½½æ–°ç»éªŒåº“: [E2(updated), E3, E4]  â† ç«‹å³ä½¿ç”¨æ›´æ–°åçš„ç»éªŒâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” **ä¸¤ç§çŸ¥è¯†æ¥æºå¯¹æ¯”**

| ç‰¹å¾ | RAG Knowledge | GRPO Experience |
|------|---------------|-----------------|
| **æ¥æº** | çŸ¥è¯†åº“æ£€ç´¢ | LLMåˆ†ærolloutå·®å¼‚ |
| **ç±»å‹** | å…¬å¼ã€å®šç†ã€è§„åˆ™ | é—®é¢˜ç»éªŒã€é”™è¯¯æ€»ç»“ |
| **ç‰¹ç‚¹** | é™æ€çš„ã€æ ‡å‡†çš„ | åŠ¨æ€çš„ã€æ¼”åŒ–çš„ |
| **ç¤ºä¾‹** | `F = ma` | `è‡ªç”±è½ä½“ç”¨g=9.8ï¼Œä¸è¦è¿‘ä¼¼` |
| **ç®¡ç†æ–¹å¼** | çŸ¥è¯†åº“ç»´æŠ¤ | add/modify/delete |
| **é€‚ç”¨èŒƒå›´** | é€šç”¨ | ç‰¹å®šé—®é¢˜ç±»å‹ |
| **æ­£ç¡®æ€§** | ç¡®å®š | å¯èƒ½é”™è¯¯ï¼ˆéœ€è¦ä¿®æ­£ï¼‰ |

---

## ğŸ“ **ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•**

### **æ ¸å¿ƒä¿®æ”¹ï¼š**
1. âœ… `engine/scaffolder.py`
   - æ·»åŠ  `experiences` å‚æ•°
   - åœ¨promptä¸­åˆ†åˆ«æ ¼å¼åŒ–ä¸¤ç§çŸ¥è¯†

2. âœ… `prompts/scaffolding_prompt_v3.txt`
   - æ·»åŠ  `{prior_experiences}` å ä½ç¬¦
   - æ˜ç¡®æ ‡æ³¨çŸ¥è¯†æ¥æº

### **è®­ç»ƒè„šæœ¬æ›´æ–°ï¼š**
3. âœ… `grpo_training/generator1.py`
   - åŠ¨æ€åŠ è½½ç»éªŒåº“
   - æ˜¾ç¤ºç»éªŒåº“å¤§å°å˜åŒ–

4. âœ… `grpo_training/generator2.py`
   - åŒä¸Š

5. âœ… `grpo_training/generator3.py`
   - åŒä¸Š

### **ä¸»æµç¨‹æ›´æ–°ï¼š**
6. âœ… `main.py`
   - å•æ™ºèƒ½ä½“æ¨¡å¼æ”¯æŒæ–°å‚æ•°

### **æ–‡æ¡£ï¼š**
7. âœ… `grpo_training/åŠ¨æ€ç»éªŒç®¡ç†è¯´æ˜.md`
   - æ·»åŠ å‚æ•°åˆ†ç¦»è®¾è®¡è¯´æ˜

8. âœ… `grpo_training/å‚æ•°åˆ†ç¦»è®¾è®¡è¯´æ˜.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰

---

## âœ… **è®¾è®¡ä¼˜åŠ¿**

### 1. **æ¸…æ™°çš„èŒè´£è¾¹ç•Œ**
```python
# RAG: æä¾›é€šç”¨é¢†åŸŸçŸ¥è¯†
retrieved_knowledge = ["F = ma", "v = u + at"]

# GRPO: æä¾›é—®é¢˜è§£å†³ç»éªŒ
experiences = ["è‡ªç”±è½ä½“ç”¨g=9.8", "ä¸è¦æ··ç”¨F=maå’Œè¿åŠ¨å­¦å…¬å¼"]
```

### 2. **ç‹¬ç«‹å¯ç”¨/ç¦ç”¨**
```python
# åªç”¨GRPOç»éªŒ
scaffold = generate_scaffold(
    problem_text=problem,
    retrieved_knowledge=[],  # RAG disabled
    experiences=experiences   # GRPO enabled
)

# åŒæ—¶ä½¿ç”¨RAGå’ŒGRPO
scaffold = generate_scaffold(
    problem_text=problem,
    retrieved_knowledge=rag_knowledge,
    experiences=grpo_experiences
)

# éƒ½ä¸ç”¨ï¼ˆçº¯LLMï¼‰
scaffold = generate_scaffold(
    problem_text=problem,
    retrieved_knowledge=[],
    experiences=[]
)
```

### 3. **ä¾¿äºè°ƒè¯•å’Œåˆ†æ**
- å¯ä»¥å•ç‹¬åˆ†æRAGçŸ¥è¯†å¯¹ç»“æœçš„å½±å“
- å¯ä»¥å•ç‹¬åˆ†æGRPOç»éªŒå¯¹ç»“æœçš„å½±å“
- å¯ä»¥æ¯”è¾ƒä¸åŒç»„åˆçš„æ•ˆæœ

### 4. **ç¬¦åˆç›´è§‰**
- **RAG**: "æˆ‘æŸ¥åˆ°äº†è¿™äº›å…¬å¼å’Œå®šç†"
- **GRPO**: "æˆ‘ä»ä¹‹å‰çš„é”™è¯¯ä¸­å­¦åˆ°äº†è¿™äº›ç»éªŒ"
- ä¸¤è€…éƒ½æ˜¯å¸®åŠ©LLMæ›´å¥½åœ°è§£é¢˜ï¼Œä½†æ¥æºå’Œæ€§è´¨å®Œå…¨ä¸åŒ

---

## ğŸš€ **ä½¿ç”¨å»ºè®®**

### **è®­ç»ƒé˜¶æ®µï¼ˆGRPOï¼‰ï¼š**
```python
# RAGç¦ç”¨ï¼Œåªç”¨GRPOåŠ¨æ€ç»éªŒ
scaffold = generate_scaffold(
    problem_text=problem,
    retrieved_knowledge=[],  # ç¦ç”¨RAG
    experiences=load_experiences(generator_id)  # åŠ¨æ€åŠ è½½ç»éªŒ
)
```

### **æ¨ç†é˜¶æ®µï¼ˆProductionï¼‰ï¼š**
```python
# åŒæ—¶ä½¿ç”¨RAGå’ŒGRPO
scaffold = generate_scaffold(
    problem_text=problem,
    retrieved_knowledge=retrieve_from_kb(problem),  # RAGæ£€ç´¢
    experiences=load_trained_experiences(generator_id)  # åŠ è½½è®­ç»ƒå¥½çš„ç»éªŒ
)
```

### **å¯¹æ¯”å®éªŒï¼š**
```python
# å®éªŒ1: çº¯LLMï¼ˆbaselineï¼‰
scaffold_baseline = generate_scaffold(problem, [], [])

# å®éªŒ2: åªç”¨RAG
scaffold_rag = generate_scaffold(problem, rag_knowledge, [])

# å®éªŒ3: åªç”¨GRPO
scaffold_grpo = generate_scaffold(problem, [], grpo_experiences)

# å®éªŒ4: RAG + GRPO
scaffold_both = generate_scaffold(problem, rag_knowledge, grpo_experiences)

# å¯¹æ¯”æ•ˆæœ
```

---

## ğŸ¯ **æ€»ç»“**

è¿™æ¬¡å‚æ•°åˆ†ç¦»è®¾è®¡çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š
1. âœ… **èŒè´£æ¸…æ™°** - RAGè´Ÿè´£çŸ¥è¯†ï¼ŒGRPOè´Ÿè´£ç»éªŒ
2. âœ… **åŠ¨æ€è®­ç»ƒ** - ç»éªŒåº“å®æ—¶æ›´æ–°ï¼Œç«‹å³ç”Ÿæ•ˆ
3. âœ… **çµæ´»ç»„åˆ** - å¯ä»¥ç‹¬ç«‹æˆ–ç»„åˆä½¿ç”¨
4. âœ… **ä¾¿äºç ”ç©¶** - å¯ä»¥å•ç‹¬åˆ†æå„è‡ªçš„è´¡çŒ®

**å…³é”®æœºåˆ¶ï¼š**
- RAG: `retrieved_knowledge` â†’ é™æ€çŸ¥è¯†
- GRPO: `experiences` â†’ åŠ¨æ€ç»éªŒ
- è®­ç»ƒæ—¶ï¼šæ¯ä¸ªé—®é¢˜å‰åŠ¨æ€åŠ è½½æœ€æ–°ç»éªŒåº“
- æ›´æ–°åï¼šä¸‹ä¸ªé—®é¢˜ç«‹å³ä½¿ç”¨æ–°ç»éªŒ

è¿™æ‰æ˜¯**çœŸæ­£çš„Training-FreeæŒç»­å­¦ä¹ ** + **çŸ¥è¯†ä¸ç»éªŒåˆ†ç¦»ç®¡ç†**ï¼ğŸ‰

