# JSON åˆ†æ•°æ ¼å¼ä¿®å¤å½±å“åˆ†æ

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

LLM ç”Ÿæˆçš„ JSON ä¸­åŒ…å« Python é£æ ¼çš„åˆ†æ•°ï¼ˆå¦‚ `1/3`ï¼‰ï¼Œè¿™ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼ã€‚

## ğŸ”§ å½“å‰ä¿®å¤æ–¹æ¡ˆ

å°†åˆ†æ•°è½¬æ¢ä¸º**å­—ç¬¦ä¸²æ ¼å¼**ï¼š
- **è½¬æ¢å‰**ï¼š`"log2_y_over_xz": 1/3` âŒ æ— æ•ˆ JSON
- **è½¬æ¢å**ï¼š`"log2_y_over_xz": "1/3"` âœ… æœ‰æ•ˆ JSON

## ğŸ” ä¸‹æ¸¸å½±å“åˆ†æ

### 1. **LLM Computer** (å½“å‰ä¸»è¦ä½¿ç”¨æ¨¡å¼) âœ… æ— å½±å“

**ä½ç½®**ï¼š`engine/llm_computer.py`

**ä½¿ç”¨æ–¹å¼**ï¼š
- LLM Computer ä¸ç›´æ¥è¯»å– `knowns` å­—æ®µçš„æ•°å€¼
- å®ƒå°†æ•´ä¸ª `causal_scaffold` å’Œ `problem_text` ä¼ é€’ç»™ LLM
- LLM ä» problem_text ä¸­æå–æ•°å€¼è¿›è¡Œè®¡ç®—

**ç»“è®º**ï¼šâœ… **å®Œå…¨æ— å½±å“**ï¼Œå› ä¸ºï¼š
1. LLM ä¸ä¾èµ– `knowns` ä¸­çš„å…·ä½“æ•°å€¼
2. LLM ä¼šä»é—®é¢˜æ–‡æœ¬ä¸­é‡æ–°æå–æ•°å€¼
3. scaffold ä»…ä½œä¸ºç»“æ„åŒ–æŒ‡å¯¼

---

### 2. **Symbolic Executor** (å·²å¼ƒç”¨) âš ï¸ æœ‰æ½œåœ¨å½±å“

**ä½ç½®**ï¼š`engine/executor.py` (ç¬¬87è¡Œ)

**ä½¿ç”¨æ–¹å¼**ï¼š
```python
# ç›´æ¥å°† knowns å¤åˆ¶åˆ° variables å­—å…¸
self.variables = dict(causal_scaffold.get("knowns", {}))
```

**æ½œåœ¨é—®é¢˜**ï¼š
- å¦‚æœå¯ç”¨ç¬¦å·æ‰§è¡Œï¼Œå­—ç¬¦ä¸² `"1/3"` æ— æ³•ç›´æ¥ç”¨äº SymPy è®¡ç®—
- éœ€è¦å…ˆè§£æï¼š`eval("1/3")` æˆ– `Fraction("1/3")`

**ä½†æ˜¯**ï¼š
- âœ… ç”¨æˆ·ç³»ç»Ÿå½“å‰**å¼ºåˆ¶ä½¿ç”¨ LLM æ¨¡å¼**ï¼ˆ`main.py` ç¬¬56è¡Œï¼‰
- âœ… ç¬¦å·æ‰§è¡Œè·¯å¾„å·²è¢«ç¦ç”¨

**ç»“è®º**ï¼šâš ï¸ **å½“å‰æ— å½±å“**ï¼Œä½†å¦‚æœå°†æ¥æ¢å¤ç¬¦å·æ‰§è¡Œï¼Œéœ€è¦æ·»åŠ è§£æé€»è¾‘

---

### 3. **Synthesizer** (è§£é‡Šç”Ÿæˆ) âœ… æ— å½±å“

**ä½ç½®**ï¼š`engine/synthesizer.py`

**ä½¿ç”¨æ–¹å¼**ï¼š
```python
# ä»…æ£€æŸ¥ knowns çš„å€¼æ˜¯å¦ä¸º None
knowns = executed_scaffold.get("knowns", {})
is_symbolic = any(v is None for v in knowns.values())
```

**ç»“è®º**ï¼šâœ… **æ— å½±å“**
- åªæ£€æŸ¥æ˜¯å¦ä¸º `None`ï¼Œä¸å…³å¿ƒå…·ä½“æ•°å€¼ç±»å‹
- å­—ç¬¦ä¸² `"1/3"` ä¸æ˜¯ `None`ï¼Œé€»è¾‘æ­£å¸¸

---

### 4. **GRPO Trainer** (è®­ç»ƒç³»ç»Ÿ) âœ… æ— å½±å“

**ä½¿ç”¨æ–¹å¼**ï¼š
- ç»éªŒç®¡ç†å™¨å­˜å‚¨å’Œæ£€ç´¢ scaffold ç»“æ„
- ä¸æ‰§è¡Œæ•°å€¼è®¡ç®—

**ç»“è®º**ï¼šâœ… **æ— å½±å“**

---

### 5. **Multi-Agent Scaffolder** (ç”Ÿæˆå™¨å’Œæ‰¹åˆ¤è€…) âœ… æ— å½±å“

**ä½¿ç”¨æ–¹å¼**ï¼š
- ç”Ÿæˆå’Œèåˆ scaffold ç»“æ„
- ä¸æ‰§è¡Œæ•°å€¼è®¡ç®—

**ç»“è®º**ï¼šâœ… **æ— å½±å“**

---

## âœ… æ€»ç»“

### å½“å‰ç³»ç»Ÿï¼ˆLLM æ¨¡å¼ï¼‰
| ç»„ä»¶ | å½±å“ | åŸå›  |
|------|------|------|
| LLM Computer | âœ… æ—  | ä¸ä½¿ç”¨ knowns æ•°å€¼ |
| Symbolic Executor | âœ… æ—  | å·²ç¦ç”¨ |
| Synthesizer | âœ… æ—  | åªæ£€æŸ¥ None |
| GRPO Trainer | âœ… æ—  | ä¸æ‰§è¡Œè®¡ç®— |
| Scaffolder | âœ… æ—  | åªç”Ÿæˆç»“æ„ |

### æœªæ¥å¦‚æœæ¢å¤ç¬¦å·æ‰§è¡Œæ¨¡å¼
éœ€è¦åœ¨ `engine/executor.py` çš„ `execute_plan` æ–¹æ³•ä¸­æ·»åŠ è§£æé€»è¾‘ï¼š

```python
def execute_plan(self, causal_scaffold: Dict[str, Any]) -> Optional[Dict[str, Any]]:
    # ...
    
    # Load known variables from scaffold
    knowns = causal_scaffold.get("knowns", {})
    
    # ğŸ†• Parse string fractions to numbers
    self.variables = {}
    for key, value in knowns.items():
        if isinstance(value, str) and '/' in value:
            # Parse fraction: "1/3" â†’ 0.333...
            try:
                self.variables[key] = eval(value)
            except:
                self.variables[key] = value
        else:
            self.variables[key] = value
    
    # Continue execution...
```

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### å½“å‰æ–¹æ¡ˆï¼šâœ… ç»§ç»­ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼

**ä¼˜ç‚¹**ï¼š
1. âœ… å®Œå…¨å…¼å®¹å½“å‰ LLM æ¨¡å¼
2. âœ… ä¿ç•™ç²¾åº¦ï¼ˆä¸è½¬æ¢ä¸ºæµ®ç‚¹æ•°ï¼‰
3. âœ… æœ‰æ•ˆçš„ JSON æ ¼å¼
4. âœ… æ˜“äºè°ƒè¯•å’Œé˜…è¯»

**ç¼ºç‚¹**ï¼š
1. âš ï¸ å¦‚æœæ¢å¤ç¬¦å·æ‰§è¡Œï¼Œéœ€è¦æ·»åŠ è§£æé€»è¾‘ï¼ˆä½†è¿™å¾ˆç®€å•ï¼‰

### å¤‡é€‰æ–¹æ¡ˆï¼šåœ¨ Prompt ä¸­è¦æ±‚ LLM ä½¿ç”¨å°æ•°

ä¿®æ”¹ scaffolding promptï¼Œè¦æ±‚ LLM åœ¨ `knowns` ä¸­ä½¿ç”¨å°æ•°è€Œä¸æ˜¯åˆ†æ•°ï¼š

```
**IMPORTANT**: 
- In the "knowns" dictionary, use decimal numbers (e.g., 0.5, 0.333) 
  instead of fractions (e.g., 1/2, 1/3)
- Fractions are NOT valid JSON
```

**ä¼˜ç‚¹**ï¼š
- æºå¤´è§£å†³é—®é¢˜
- ä¸éœ€è¦åå¤„ç†

**ç¼ºç‚¹**ï¼š
- LLM å¯èƒ½ä»ç„¶å¶å°”ç”Ÿæˆåˆ†æ•°
- éœ€è¦å›é€€å¤„ç†æœºåˆ¶

---

## ğŸ’¡ æœ€ç»ˆå»ºè®®

**ä¿æŒå½“å‰çš„å­—ç¬¦ä¸²è½¬æ¢æ–¹æ¡ˆ**ï¼Œå› ä¸ºï¼š

1. âœ… å¯¹å½“å‰ç³»ç»Ÿï¼ˆLLM æ¨¡å¼ï¼‰**é›¶å½±å“**
2. âœ… ç®€å•ã€ç¨³å®šã€å¯é¢„æµ‹
3. âœ… ä¿ç•™äº†æ•°å­¦ç²¾åº¦
4. âœ… å¦‚æœå°†æ¥éœ€è¦ç¬¦å·æ‰§è¡Œï¼Œåªéœ€æ·»åŠ å‡ è¡Œè§£æä»£ç 

**å®‰å…¨æ€§ä¿éšœ**ï¼šåœ¨ `main.py` ä¸­å·²ç»å¼ºåˆ¶ LLM æ¨¡å¼ï¼Œç¬¦å·æ‰§è¡Œè¢«æ˜ç¡®ç¦ç”¨ã€‚

---

**æ—¥æœŸ**ï¼š2025-10-26  
**çŠ¶æ€**ï¼šâœ… å·²éªŒè¯å®‰å…¨


